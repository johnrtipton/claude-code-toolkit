# mypy Configuration for Django Projects
#
# Copy this file to your Django project root as mypy.ini
#
# Usage:
#   mypy .                    # Check entire project
#   mypy myapp/               # Check specific app
#   mypy --strict myapp/      # Strict mode for specific app
#
# Adjust django_settings_module to match your project

[mypy]
# === Django-Stubs Plugin ===
# Required for Django type checking
plugins = mypy_django_plugin.main

# === Basic Settings ===
python_version = 3.11
warn_return_any = True
warn_unused_configs = True
show_error_codes = True
show_column_numbers = True
pretty = True

# === Type Checking ===
# Start with these enabled, gradually add stricter settings
check_untyped_defs = True
disallow_untyped_defs = False  # Enable after adding type hints to your code
disallow_any_unimported = False
disallow_any_explicit = False
disallow_any_generics = True
disallow_subclassing_any = True

# === Warnings ===
warn_redundant_casts = True
warn_unused_ignores = True
warn_no_return = True
warn_unreachable = True

# === Strictness (enable these gradually) ===
# Uncomment these as you improve type coverage
# disallow_untyped_calls = True
# disallow_incomplete_defs = True
# disallow_untyped_decorators = True
# no_implicit_optional = True
# strict_equality = True
# strict_concatenate = True

# === Error Handling ===
# Allow flexible Any expressions initially
disallow_any_expr = False

# Show error context
show_error_context = True

# === Import Discovery ===
namespace_packages = True
explicit_package_bases = True
ignore_missing_imports = False

# === Django-Stubs Configuration ===
[mypy.plugins.django-stubs]
# IMPORTANT: Change this to your Django settings module
django_settings_module = "myproject.settings"

# Strict settings for Django ORM
strict_settings = False  # Set to True after you've fixed initial errors

# === Ignore Patterns ===

# Ignore migrations (highly recommended)
[mypy-*.migrations.*]
ignore_errors = True

# Ignore tests initially (remove after adding type hints to tests)
# [mypy-*.tests.*]
# ignore_errors = True

# === Third-Party Packages Without Stubs ===
# Add packages that don't have type stubs here

[mypy-celery.*]
ignore_missing_imports = True

[mypy-kombu.*]
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True

# Django extensions and third-party packages
[mypy-django_extensions.*]
ignore_missing_imports = True

[mypy-debug_toolbar.*]
ignore_missing_imports = True

[mypy-django_filters.*]
ignore_missing_imports = True

# Uncomment if using these packages:
# [mypy-boto3.*]
# ignore_missing_imports = True

# [mypy-botocore.*]
# ignore_missing_imports = True

# [mypy-stripe.*]
# ignore_missing_imports = True

# [mypy-requests_oauthlib.*]
# ignore_missing_imports = True

# === Per-App Configuration ===
# You can configure different strictness levels for different apps

# Example: Strict mode for core business logic
# [mypy-myapp.core.*]
# disallow_untyped_defs = True
# disallow_any_generics = True
# warn_return_any = True

# Example: Relaxed mode for legacy code
# [mypy-myapp.legacy.*]
# ignore_errors = True

# === Performance ===
# Enable incremental mode for faster subsequent runs
incremental = True
cache_dir = .mypy_cache

# Use fine-grained incremental cache
cache_fine_grained = True

# === Output ===
# Show absolute paths in error messages
show_absolute_path = True

# Color output (set to False for CI/CD)
color_output = True

# === Error Reporting ===
# Report any partially annotated functions
disallow_incomplete_defs = False  # Enable after initial setup

# Require return type annotations
disallow_untyped_defs = False  # Enable after adding return types

# === Recommended Progressive Setup ===
#
# Stage 1 (Current configuration):
# - Basic type checking enabled
# - Migrations ignored
# - Third-party packages configured
# - Run: mypy . --show-error-codes
#
# Stage 2 (After fixing initial errors):
# Uncomment:
#   disallow_untyped_defs = True
#   strict_settings = True
#
# Stage 3 (Strict mode):
# Uncomment all strictness settings above
#
# Stage 4 (Maximum strictness):
# Remove ignore_missing_imports from third-party packages
# Add type stubs or create custom stubs

# === Notes ===
# 1. Install required packages:
#    pip install mypy django-stubs django-stubs-ext
#
# 2. For Django REST Framework, also install:
#    pip install djangorestframework-stubs
#
# 3. Run mypy:
#    mypy .
#
# 4. For HTML report:
#    mypy . --html-report ./mypy-report
#
# 5. Update django_settings_module above to match your project
#
# 6. See references/mypy-django-configuration.md for detailed explanations
